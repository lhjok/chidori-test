(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657],{97061:function(n,e,t){let i=t(40042);n.exports=i("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},40042:function(n){"use strict";n.exports=function(n){if(n.length>=255)throw TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var i=0;i<n.length;i++){var o=n.charAt(i),r=o.charCodeAt(0);if(255!==e[r])throw TypeError(o+" is ambiguous");e[r]=i}var a=n.length,s=n.charAt(0),l=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function p(n){if("string"!=typeof n)throw TypeError("Expected String");if(0===n.length)return new Uint8Array;for(var t=0,i=0,o=0;n[t]===s;)i++,t++;for(var r=(n.length-t)*l+1>>>0,c=new Uint8Array(r);n[t];){var p=e[n.charCodeAt(t)];if(255===p)return;for(var h=0,d=r-1;(0!==p||h<o)&&-1!==d;d--,h++)p+=a*c[d]>>>0,c[d]=p%256>>>0,p=p/256>>>0;if(0!==p)throw Error("Non-zero carry");o=h,t++}for(var E=r-o;E!==r&&0===c[E];)E++;for(var A=new Uint8Array(i+(r-E)),u=i;E!==r;)A[u++]=c[E++];return A}return{encode:function(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===e.length)return"";for(var t=0,i=0,o=0,r=e.length;o!==r&&0===e[o];)o++,t++;for(var l=(r-o)*c+1>>>0,p=new Uint8Array(l);o!==r;){for(var h=e[o],d=0,E=l-1;(0!==h||d<i)&&-1!==E;E--,d++)h+=256*p[E]>>>0,p[E]=h%a>>>0,h=h/a>>>0;if(0!==h)throw Error("Non-zero carry");i=d,o++}for(var A=l-i;A!==l&&0===p[A];)A++;for(var u=s.repeat(t);A<l;++A)u+=n.charAt(p[A]);return u},decodeUnsafe:p,decode:function(n){var e=p(n);if(e)return e;throw Error("Non-base"+a+" character")}}}},60657:function(n,e,t){"use strict";t.r(e),t.d(e,{FractalWalletAdapterImpl:function(){return S}}),(s=c||(c={})).PROJECT_APPROVED="PROJECT_APPROVED",s.HANDSHAKE="HANDSHAKE",s.HANDSHAKE_ACK="HANDSHAKE_ACK",s.SIGNED_TRANSACTION="SIGNED_TRANSACTION",s.SIGNED_PARTIAL_TRANSACTION="SIGNED_PARTIAL_TRANSACTION",s.FAILED_TO_SIGN_TRANSACTION="FAILED_TO_SIGN_TRANSACTION",s.TRANSACTION_DENIED="TRANSACTION_DENIED",s.SOLANA_WALLET_ADAPTER_APPROVED="SOLANA_WALLET_ADAPTER_APPROVED",s.SOLANA_WALLET_ADAPTER_DENIED="SOLANA_WALLET_ADAPTER_DENIED",s.POPUP_CLOSED="POPUP_CLOSED",s.TRANSACTION_SIGNATURE_NEEDED="TRANSACTION_SIGNATURE_NEEDED",s.TRANSACTION_SIGNATURE_NEEDED_RESPONSE="TRANSACTION_SIGNATURE_NEEDED_RESPONSE",s.AUTH_LOADED="AUTH_LOADED",s.MESSAGE_SIGNATURE_NEEDED="MESSAGE_SIGNATURE_NEEDED",s.MESSAGE_SIGNATURE_NEEDED_RESPONSE="MESSAGE_SIGNATURE_NEEDED_RESPONSE",s.ONRAMP_FULFILLMENT_COMPLETE="ONRAMP_FULFILLMENT_COMPLETE",s.ONRAMP_REJECTED="ONRAMP_REJECTED",(l=p||(p={})).UNKNOWN="UNKNOWN",l.REACT_SDK="REACT_SDK",l.SOLANA_WALLET_ADAPTER="SOLANA_WALLET_ADAPTER";class i{constructor(n,e){this.validatedOrigin=n,this.targetWindow=e,this.handlers=new Map}off(n,e){let t=this.handlers.get(n);null==t||t.delete(e)}on(n,e){var t;let i=null!==(t=this.handlers.get(n))&&void 0!==t?t:new Set;i.add(e),this.handlers.set(n,i)}send({event:n,payload:e}){this.targetWindow.postMessage({event:n,payload:e},this.validatedOrigin)}runHandlersForEvent(n,e){let t=this.handlers.get(n);if(t)for(let n of t)n(e)}resetHandlers(){this.handlers.clear()}export(){return{off:this.off.bind(this),on:this.on.bind(this),send:this.send.bind(this),validatedOrigin:this.validatedOrigin}}}let o=["resizable","scrollbars=1","status=1"];class r{constructor(n){this.platform=n,this.connection=null,this.popupWindow=null,this.handleMessage=n=>{var e,t,o;if(!("https://www.fractal.is"===(o=n.origin)||"https://fractal.is"===o))return;let r=n.origin;if(this.popupWindow){if(n.data.event===c.HANDSHAKE&&!this.connection){if(!this.verifyAndResetNonce(null===(e=n.data.payload)||void 0===e?void 0:e.nonce))return;this.popupWindow.postMessage({event:c.HANDSHAKE_ACK,payload:{platform:this.platform}},r),this.connection=new i(r,this.popupWindow),null===(t=this.connectionUpdatedCallback)||void 0===t||t.call(this,this.connection)}this.connection&&(this.connection.runHandlersForEvent(n.data.event,n.data.payload),n.data.event===c.POPUP_CLOSED&&this.connection&&(this.resetConnection(),this.popupWindow=null))}}}initialize(){return window.addEventListener("message",this.handleMessage),this}tearDown(){return window.removeEventListener("message",this.handleMessage),this.resetConnection(),this}async open({url:n,widthPx:e=400,heightPx:t=600,nonce:i}){var r;if((null===(r=this.popupWindow)||void 0===r?void 0:r.closed)&&this.resetConnectionAndPopupWindow(),this.popupWindow)return;this.initialize(),i&&(this.nonce=i);let a=window.screenX+(window.innerWidth-e)/2,s=window.screenY+(window.innerHeight-t)/2;this.popupWindow=function({left:n=0,scope:e=window,top:t=0,width:i=600,height:r=600,url:a}){return e.open(a,"fractal:approval:popup",function({height:n,left:e,top:t,width:i}){return["popup",`left=${e}`,`top=${t}`,`width=${i}`,`height=${n}`,...o].join(",")}({height:r,left:n,top:t,width:i}))}({height:t,left:a,top:s,url:"string"==typeof n?n:void 0,width:e}),n instanceof Promise&&this.setUrl(await n)}close(){this.popupWindow&&(this.popupWindow.close(),this.resetConnectionAndPopupWindow())}onConnectionUpdated(n){return this.connectionUpdatedCallback=n,this}getConnection(){return this.connection}setUrl(n){this.popupWindow&&(this.popupWindow.location=n)}resetConnectionAndPopupWindow(){this.resetConnection(),this.popupWindow=null}resetConnection(){var n,e;null===(n=this.connection)||void 0===n||n.resetHandlers(),this.connection=null,null===(e=this.connectionUpdatedCallback)||void 0===e||e.call(this,this.connection)}verifyAndResetNonce(n){if(!this.nonce)return!0;let e=n===this.nonce;return e&&(this.nonce=void 0),e}}function a(n){return null!==n&&"object"==typeof n}t(67294);var s,l,c,p,h=t(35615),d=t(80282),E=t(97061);function A(){return`${u()}${u()}${u()}`}function u(){return(Math.random()+1).toString(36).substring(7)}let g="Unknown Error",N="https://fractal.is",w=`${N}/wallet-adapter/approve`,f=`${N}/wallet-adapter/sign`,T=`${N}/wallet-adapter/sign/message`,_="RdxqNYxF";class S{constructor(){this.popupManager=new r(p.SOLANA_WALLET_ADAPTER),this.publicKey=null,this.connecting=!1}getPublicKey(){return this.publicKey}async connect(){let n,e;let t=window.localStorage.getItem(_);if(t)return this.publicKey=new d.PublicKey(t),Promise.resolve();let i=A();this.popupManager.open({nonce:i,url:`${w}/${i}`});let o=t=>{if(!(a(t)&&"solanaPublicKey"in t&&"string"==typeof t.solanaPublicKey)){e(new h.$w(`Malformed payload when setting up connection. Expected { solanaPublicKey: string } but received ${JSON.stringify(t)}`)),this.popupManager.close();return}try{this.publicKey=new d.PublicKey(t.solanaPublicKey),window.localStorage.setItem(_,t.solanaPublicKey),n()}catch(t){let n=new h.Nx(t instanceof Error?t.message:g,t);e(n)}this.popupManager.close()},r=()=>{e(new h.$w("The user denied the connection.")),this.popupManager.close()},s=()=>{e(new h.$w("The user denied the connection.")),this.popupManager.close()};return this.popupManager.onConnectionUpdated(n=>{n&&(n.on(c.SOLANA_WALLET_ADAPTER_APPROVED,o),n.on(c.SOLANA_WALLET_ADAPTER_DENIED,r),n.on(c.POPUP_CLOSED,s))}),new Promise((t,i)=>{n=t,e=i})}async disconnect(){this.popupManager.tearDown(),this.publicKey=null,window.localStorage.removeItem(_)}async signTransaction(n){try{return this.checkWalletReadiness(),(await this.signTransactions([n]))[0]}catch(e){let n=e;throw e instanceof h.lj||(n=new h.PY(e instanceof Error?e.message:g,e)),n}}async signAllTransactions(n){try{return this.checkWalletReadiness(),await this.signTransactions(n)}catch(e){let n=e;throw e instanceof h.lj||(n=new h.PY(e instanceof Error?e.message:g,e)),n}}async signMessage(n){let e,t;let i=new TextDecoder().decode(n),o=n=>{if(!(a(n)&&"decodedSignature"in n&&"string"==typeof n.decodedSignature)){let e=new h.fk(`Malformed payload when signing message. Expected { decodedSignature: string } but received ${JSON.stringify(n)}`);t(e),this.popupManager.close();return}let i=Uint8Array.from(n.decodedSignature.split(",").map(n=>Number(n)));e(i),this.popupManager.close()},r=()=>{t(new h.fk("The user did not approve the message")),this.popupManager.close()},s=()=>{var n;null===(n=this.popupManager.getConnection())||void 0===n||n.send({event:c.MESSAGE_SIGNATURE_NEEDED,payload:{decodedMessage:i}})},l=A();return this.popupManager.open({heightPx:Math.max(600,Math.floor(.8*window.innerHeight)),nonce:l,url:`${T}/${l}`,widthPx:Math.min(850,Math.floor(.8*window.innerWidth))}),this.popupManager.onConnectionUpdated(n=>{n&&(n.on(c.MESSAGE_SIGNATURE_NEEDED_RESPONSE,o),n.on(c.TRANSACTION_DENIED,r),n.on(c.POPUP_CLOSED,r),n.on(c.AUTH_LOADED,s))}),new Promise((n,i)=>{e=n,t=i})}async signTransactions(n){let e,t;let i=n=>{if(!(a(n)&&"signedB58Transactions"in n&&Array.isArray(n.signedB58Transactions)&&n.signedB58Transactions.every(n=>"string"==typeof n))){let e=new h.PY(`Malformed payload when signing transactions. Expected { signedB58Transactions: string[] } but received ${JSON.stringify(n)}`);t(e),this.popupManager.close();return}let i=n.signedB58Transactions.map(n=>d.Transaction.from(E.decode(n)));e(i),this.popupManager.close()},o=()=>{t(new h.PY("The user did not approve the transaction")),this.popupManager.close()},r=()=>{var e;let t={unsignedB58Transactions:n.map(n=>E.encode(n.serializeMessage()))};null===(e=this.popupManager.getConnection())||void 0===e||e.send({event:c.TRANSACTION_SIGNATURE_NEEDED,payload:t})},s=A();return this.popupManager.open({heightPx:Math.max(600,Math.floor(.8*window.innerHeight)),nonce:s,url:`${f}/${s}`,widthPx:Math.min(850,Math.floor(.8*window.innerWidth))}),this.popupManager.onConnectionUpdated(n=>{n&&(n.on(c.TRANSACTION_SIGNATURE_NEEDED_RESPONSE,i),n.on(c.TRANSACTION_DENIED,o),n.on(c.POPUP_CLOSED,o),n.on(c.AUTH_LOADED,r))}),new Promise((n,i)=>{e=n,t=i})}checkWalletReadiness(){if(null===this.publicKey)throw new h.oS("`publicKey` is null. Did you forget to call `.connect()`?")}}}}]);