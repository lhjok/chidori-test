(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{97061:function(e,n,t){let r=t(40042);e.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},40042:function(e){"use strict";e.exports=function(e){if(e.length>=255)throw TypeError("Alphabet too long");for(var n=new Uint8Array(256),t=0;t<n.length;t++)n[t]=255;for(var r=0;r<e.length;r++){var i=e.charAt(r),o=i.charCodeAt(0);if(255!==n[o])throw TypeError(i+" is ambiguous");n[o]=r}var s=e.length,a=e.charAt(0),c=Math.log(s)/Math.log(256),l=Math.log(256)/Math.log(s);function h(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var t=0,r=0,i=0;e[t]===a;)r++,t++;for(var o=(e.length-t)*c+1>>>0,l=new Uint8Array(o);e[t];){var h=n[e.charCodeAt(t)];if(255===h)return;for(var p=0,d=o-1;(0!==h||p<i)&&-1!==d;d--,p++)h+=s*l[d]>>>0,l[d]=h%256>>>0,h=h/256>>>0;if(0!==h)throw Error("Non-zero carry");i=p,t++}for(var E=o-i;E!==o&&0===l[E];)E++;for(var u=new Uint8Array(r+(o-E)),A=r;E!==o;)u[A++]=l[E++];return u}return{encode:function(n){if(n instanceof Uint8Array||(ArrayBuffer.isView(n)?n=new Uint8Array(n.buffer,n.byteOffset,n.byteLength):Array.isArray(n)&&(n=Uint8Array.from(n))),!(n instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===n.length)return"";for(var t=0,r=0,i=0,o=n.length;i!==o&&0===n[i];)i++,t++;for(var c=(o-i)*l+1>>>0,h=new Uint8Array(c);i!==o;){for(var p=n[i],d=0,E=c-1;(0!==p||d<r)&&-1!==E;E--,d++)p+=256*h[E]>>>0,h[E]=p%s>>>0,p=p/s>>>0;if(0!==p)throw Error("Non-zero carry");r=d,i++}for(var u=c-r;u!==c&&0===h[u];)u++;for(var A=a.repeat(t);u<c;++u)A+=e.charAt(h[u]);return A},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw Error("Non-base"+s+" character")}}}},73125:function(e,n,t){"use strict";t.r(n),t.d(n,{FractalWalletAdapterImpl:function(){return R}}),(E=A||(A={})).PROJECT_APPROVED="PROJECT_APPROVED",E.HANDSHAKE="HANDSHAKE",E.HANDSHAKE_ACK="HANDSHAKE_ACK",E.SIGNED_TRANSACTION="SIGNED_TRANSACTION",E.FAILED_TO_SIGN_TRANSACTION="FAILED_TO_SIGN_TRANSACTION",E.TRANSACTION_DENIED="TRANSACTION_DENIED",E.SOLANA_WALLET_ADAPTER_APPROVED="SOLANA_WALLET_ADAPTER_APPROVED",E.SOLANA_WALLET_ADAPTER_DENIED="SOLANA_WALLET_ADAPTER_DENIED",E.POPUP_CLOSED="POPUP_CLOSED",E.TRANSACTION_SIGNATURE_NEEDED="TRANSACTION_SIGNATURE_NEEDED",E.TRANSACTION_SIGNATURE_NEEDED_RESPONSE="TRANSACTION_SIGNATURE_NEEDED_RESPONSE",E.AUTH_LOADED="AUTH_LOADED",E.MESSAGE_SIGNATURE_NEEDED="MESSAGE_SIGNATURE_NEEDED",E.MESSAGE_SIGNATURE_NEEDED_RESPONSE="MESSAGE_SIGNATURE_NEEDED_RESPONSE",E.ONRAMP_FULFILLMENT_COMPLETE="ONRAMP_FULFILLMENT_COMPLETE",E.ONRAMP_REJECTED="ONRAMP_REJECTED",(u=g||(g={})).UNKNOWN="UNKNOWN",u.REACT_SDK="REACT_SDK",u.SOLANA_WALLET_ADAPTER="SOLANA_WALLET_ADAPTER";class r{constructor(e,n){this.validatedOrigin=e,this.targetWindow=n,this.handlers=new Map}off(e,n){let t=this.handlers.get(e);null==t||t.delete(n)}on(e,n){var t;let r=null!==(t=this.handlers.get(e))&&void 0!==t?t:new Set;r.add(n),this.handlers.set(e,r)}send({event:e,payload:n}){this.targetWindow.postMessage({event:e,payload:n},this.validatedOrigin)}runHandlersForEvent(e,n){let t=this.handlers.get(e);if(t)for(let e of t)e(n)}resetHandlers(){this.handlers.clear()}export(){return{off:this.off.bind(this),on:this.on.bind(this),send:this.send.bind(this),validatedOrigin:this.validatedOrigin}}}let i=["resizable","scrollbars=1","status=1"];class o{constructor(e){this.platform=e,this.connection=null,this.popupWindow=null,this.handleMessage=e=>{var n,t,i;if(!("https://www.fractal.is"===(i=e.origin)||"https://fractal.is"===i))return;let o=e.origin;if(this.popupWindow){if(e.data.event===A.HANDSHAKE&&!this.connection){if(!this.verifyAndResetNonce(null===(n=e.data.payload)||void 0===n?void 0:n.nonce))return;this.popupWindow.postMessage({event:A.HANDSHAKE_ACK,payload:{platform:this.platform}},o),this.connection=new r(o,this.popupWindow),null===(t=this.connectionUpdatedCallback)||void 0===t||t.call(this,this.connection)}this.connection&&(this.connection.runHandlersForEvent(e.data.event,e.data.payload),e.data.event===A.POPUP_CLOSED&&this.connection&&(this.resetConnection(),this.popupWindow=null))}}}initialize(){return window.addEventListener("message",this.handleMessage),this}tearDown(){return window.removeEventListener("message",this.handleMessage),this.resetConnection(),this}open({url:e,widthPx:n=400,heightPx:t=600,nonce:r}){var o;if((null===(o=this.popupWindow)||void 0===o?void 0:o.closed)&&this.resetConnectionAndPopupWindow(),this.popupWindow)return;this.initialize(),r&&(this.nonce=r);let s=window.screenX+(window.innerWidth-n)/2,a=window.screenY+(window.innerHeight-t)/2;this.popupWindow=function({left:e=0,scope:n=window,top:t=0,width:r=600,height:o=600,url:s}){return n.open(s,"fractal:approval:popup",function({height:e,left:n,top:t,width:r}){return["popup",`left=${n}`,`top=${t}`,`width=${r}`,`height=${e}`,...i].join(",")}({height:o,left:e,top:t,width:r}))}({height:t,left:s,top:a,url:e,width:n})}close(){this.popupWindow&&(this.popupWindow.close(),this.resetConnectionAndPopupWindow())}onConnectionUpdated(e){return this.connectionUpdatedCallback=e,this}getConnection(){return this.connection}resetConnectionAndPopupWindow(){this.resetConnection(),this.popupWindow=null}resetConnection(){var e,n;null===(e=this.connection)||void 0===e||e.resetHandlers(),this.connection=null,null===(n=this.connectionUpdatedCallback)||void 0===n||n.call(this,this.connection)}verifyAndResetNonce(e){if(!this.nonce)return!0;let n=e===this.nonce;return n&&(this.nonce=void 0),n}}function s(e){return null!==e&&"object"==typeof e}t(67294);class a extends Error{constructor(e,n){super(e),this.error=n}}class c extends a{constructor(){super(...arguments),this.name="WalletConnectionError"}}class l extends a{constructor(){super(...arguments),this.name="WalletPublicKeyError"}}class h extends a{constructor(){super(...arguments),this.name="WalletNotConnectedError"}}class p extends a{constructor(){super(...arguments),this.name="WalletSignMessageError"}}class d extends a{constructor(){super(...arguments),this.name="WalletSignTransactionError"}}var E,u,A,g,N=t(35959),w=t(97061);function f(){return`${T()}${T()}${T()}`}function T(){return(Math.random()+1).toString(36).substring(7)}let S="Unknown Error",_="https://fractal.is",D=`${_}/wallet-adapter/approve`,O=`${_}/wallet-adapter/sign`,P=`${_}/wallet-adapter/sign/message`,y="RdxqNYxF";class R{constructor(){this.popupManager=new o(g.SOLANA_WALLET_ADAPTER),this.publicKey=null,this.connecting=!1}getPublicKey(){return this.publicKey}async connect(){let e,n;let t=window.localStorage.getItem(y);if(t)return this.publicKey=new N.nh(t),Promise.resolve();let r=f();this.popupManager.open({nonce:r,url:`${D}/${r}`});let i=t=>{if(!(s(t)&&"solanaPublicKey"in t&&"string"==typeof t.solanaPublicKey)){n(new c(`Malformed payload when setting up connection. Expected { solanaPublicKey: string } but received ${JSON.stringify(t)}`)),this.popupManager.close();return}try{this.publicKey=new N.nh(t.solanaPublicKey),window.localStorage.setItem(y,t.solanaPublicKey),e()}catch(t){let e=new l(t instanceof Error?t.message:S,t);n(e)}this.popupManager.close()},o=()=>{n(new c("The user denied the connection.")),this.popupManager.close()},a=()=>{n(new c("The user denied the connection.")),this.popupManager.close()};return this.popupManager.onConnectionUpdated(e=>{e&&(e.on(A.SOLANA_WALLET_ADAPTER_APPROVED,i),e.on(A.SOLANA_WALLET_ADAPTER_DENIED,o),e.on(A.POPUP_CLOSED,a))}),new Promise((t,r)=>{e=t,n=r})}async disconnect(){this.popupManager.tearDown(),this.publicKey=null,window.localStorage.removeItem(y)}async signTransaction(e){try{return this.checkWalletReadiness(),(await this.signTransactions([e]))[0]}catch(n){let e=n;throw n instanceof a||(e=new d(n instanceof Error?n.message:S,n)),e}}async signAllTransactions(e){try{return this.checkWalletReadiness(),await this.signTransactions(e)}catch(n){let e=n;throw n instanceof a||(e=new d(n instanceof Error?n.message:S,n)),e}}async signMessage(e){let n,t;let r=new TextDecoder().decode(e),i=e=>{if(!(s(e)&&"decodedSignature"in e&&"string"==typeof e.decodedSignature)){let n=new p(`Malformed payload when signing message. Expected { decodedSignature: string } but received ${JSON.stringify(e)}`);t(n),this.popupManager.close();return}let r=Uint8Array.from(e.decodedSignature.split(",").map(e=>Number(e)));n(r),this.popupManager.close()},o=()=>{t(new p("The user did not approve the message")),this.popupManager.close()},a=()=>{var e;null===(e=this.popupManager.getConnection())||void 0===e||e.send({event:A.MESSAGE_SIGNATURE_NEEDED,payload:{decodedMessage:r}})},c=f();return this.popupManager.open({heightPx:Math.max(600,Math.floor(.8*window.innerHeight)),nonce:c,url:`${P}/${c}`,widthPx:Math.min(850,Math.floor(.8*window.innerWidth))}),this.popupManager.onConnectionUpdated(e=>{e&&(e.on(A.MESSAGE_SIGNATURE_NEEDED_RESPONSE,i),e.on(A.TRANSACTION_DENIED,o),e.on(A.POPUP_CLOSED,o),e.on(A.AUTH_LOADED,a))}),new Promise((e,r)=>{n=e,t=r})}async signTransactions(e){let n,t;let r=e=>{if(!(s(e)&&"signedB58Transactions"in e&&Array.isArray(e.signedB58Transactions)&&e.signedB58Transactions.every(e=>"string"==typeof e))){let n=new d(`Malformed payload when signing transactions. Expected { signedB58Transactions: string[] } but received ${JSON.stringify(e)}`);t(n),this.popupManager.close();return}let r=e.signedB58Transactions.map(e=>N.YW.from(w.decode(e)));n(r),this.popupManager.close()},i=()=>{t(new d("The user did not approve the transaction")),this.popupManager.close()},o=()=>{var n;let t={unsignedB58Transactions:e.map(e=>w.encode(e.serializeMessage()))};null===(n=this.popupManager.getConnection())||void 0===n||n.send({event:A.TRANSACTION_SIGNATURE_NEEDED,payload:t})},a=f();return this.popupManager.open({heightPx:Math.max(600,Math.floor(.8*window.innerHeight)),nonce:a,url:`${O}/${a}`,widthPx:Math.min(850,Math.floor(.8*window.innerWidth))}),this.popupManager.onConnectionUpdated(e=>{e&&(e.on(A.TRANSACTION_SIGNATURE_NEEDED_RESPONSE,r),e.on(A.TRANSACTION_DENIED,i),e.on(A.POPUP_CLOSED,i),e.on(A.AUTH_LOADED,o))}),new Promise((e,r)=>{n=e,t=r})}checkWalletReadiness(){if(null===this.publicKey)throw new h("`publicKey` is null. Did you forget to call `.connect()`?")}}}}]);